# Hello, hostname!

Now that we've got some background on Intecture, we wanted to give you our take on a "Hello, world!" app. This example is intended to demonstrate a minimally viable Intecture instance, rather than best practices for production deployments.

For the example, I am using a blank Ubuntu 14.04 VM to run a Rust project, though you can use any [supported platform](ch01-02-intro-installation.html#System%20Requirements).

#### 1. Project dependencies

Intecture relies on a few basic dependencies in order to install correctly. Let's install them now:

```bash
sudo apt-get install git pkg-config
```

#### 2. Rust compiler

As we're making a Rust project, we will also need the Rust compiler:

```bash
curl https://sh.rustup.rs -sSf | sh
# Remember to initialise Rust's env vars
. ~/.cargo/env
```

#### 3. Intecture components

In no particular order...

```bash
curl -sSf https://get.intecture.io | sh -s -- agent
curl -sSf https://get.intecture.io | sh -s -- auth
curl -sSf https://get.intecture.io | sh -s -- cli
```

> Notice that we didn't install the _API_ component. The Intecture API is available for Rust as a Cargo crate and doesn't require any special installation.

#### 4. Configure Auth server

Now that the components are installed, we need to configure and start them. Firstly we'll add a new user to the Auth server, which will be our master user. This must be done before the _Auth_ server starts, or the certificate won't be registered.

The following command will generate a new user certificate. This is your personal certificate and should be kept private and secure at all times.

```bash
sudo inauth_cli user add pete
```

> My name is Pete, but yours probably isn't. Feel free to use your own name here!

Copy the certificate and save it somewhere secure. We'll need it again in a moment.

As we're running the _Agent_ and _Auth_ daemons on the same server, we need to change the _Auth_ server's listen ports so they don't conflict with the _Agent_. Set `api_port` to _7103_ and `update_port` to _7104_.

```bash
sudo vi /etc/intecture/auth.json
```

Now we can start 'er up:

```bash
sudo service inauth start
```

#### 5. Setup your project

Now let's setup your Intecture project. This is where all your code and data will live, and it's super easy thanks to the Intecture CLI (`incli`) that we installed earlier:

```bash
incli project init hello-hostname rust
cd hello-hostname
```

Ok, remember that user certificate we created before? Time to dig that up and paste/move it to `./user.crt`.

At the same time, we'll need a copy of the _Auth_ server's public key so we can authenticate it when we ask it stuff:

```bash
cp /etc/intecture/auth.crt_public auth.crt
```

> If you're wondering where `auth.crt_public` came from, it was generated by the _Auth_ server on first run.

Next let's edit the project's `project.json`, which has some example values that need changing. Set `auth_server` to _localhost_, `auth_api_port` to 7103 and `auth_update_port` to 7104.

```bash
vi project.json
```

#### 6. Configure Agent server

Almost there! We just need to get the _Agent_ on its feet, then we can start introducing ourselves to our new Intecture host.

Just as a user needs a certificate, every _Agent_ also needs a certificate issued by the _Auth_ server. However, unlike last time, we'll be using the Intecture CLI (`incli`) to create the _Agent_ certificate. As a rule of thumb, don't use `inauth_cli` unless you are initialising a new _Auth_ server.

```bash
incli host add localhost
```

Now let's copy the certificate to its resting place:

```bash
sudo vi /etc/intecture/agent.crt
```

Aaaand now let's start 'er up!

```bash
sudo service inagent start
```

**_Vrroom!!_ Intecture is now ready to rumble!**

#### 7. Hello \<hostname\>

As our final act, let's actually make Intecture do something. For this example, it's going to be pretty simple - say hello.

Let's edit `main.rs` and make it look like this:

```rust
#[macro_use]
extern crate inapi;

use inapi::Host;

fn main() {
    let host = Host::connect_endpoint("localhost", 7101, 7102).unwrap();
    println!("Hello, {}!", needstr!(host.data_owned() => "/_telemetry/hostname").unwrap());
}
```

Run it!

```bash
incli run
```

After some consternation from the compiler, your project should say hello, after a round trip to the _Agent_ via the _Auth_ server:

```
Hello, vagrant-ubuntu-trusty-64!
```

> Don't feel sad if your hostname is a bit different to mine. I'd rather it said `freebsd` anyway ;)
